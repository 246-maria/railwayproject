{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Management</title>
    <style>
        body {
            font-family: 'Times New Roman', Times, serif;
            background-image: url("{% static 'images/WhatsApp Image 2025-04-11 at 11.36.08_8ccf0fac.jpg' %}");
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            width: 100%;
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .heading-container {
            display: flex;
            align-items: center;
            border-bottom: 2px solid green;
            margin-bottom: 20px;
            padding-bottom: 10px;
        }

        .heading-container h2 {
            color: darkgreen;
            margin: 0;
        }

        .logo {
            width: 50px;
            height: auto;
            margin-right: 10px;
            padding-top: 3px;
        }

        a.button {
            background-color: darkgreen;
            color: #ffffff;
            padding: 0.5rem 1rem;
            text-decoration: none;
            border-radius: 0.375rem;
            font-weight: 600;
        }

        a.button:hover {
            background-color: green;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #e5e7eb;
            padding: 0.5rem 1rem;
            text-align: left;
        }

        th {
            background-color: darkgreen;
            color: white;
        }

        .row-even {
            background-color: rgb(188, 226, 188); 
        }
        .row-odd {
            background-color: white;
        }

        button {
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            border: none;
            color: #ffffff;
            cursor: pointer;
            font-size: 0.875rem;
        }

        button.update {
            background-color: darkgreen;
        }

        button.update:hover {
            background-color: green;
        }

        button.delete {
            background-color: #ef4444;
        }

        button.delete:hover {
            background-color: #dc2626;
        }

        form input, form textarea, form select {
            display: block;
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            margin-bottom: 1rem;
        }

        .message-success {
            background-color: #d1fae5;
            color: #065f46;
            padding: 1rem;
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
        }

        .message-error {
            background-color: #fee2e2;
            color: #991b1b;
            padding: 1rem;
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
        }

        .hidden { display: none; }
        .flex-space { display: flex; gap: 1rem; }

        h3 { font-size: 1.5rem; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <div class="heading-container">
            <img src="{% static 'images/logo.jpg' %}" alt="My Logo" class="logo" />
            <h2>Hotel Management</h2>
        </div>

        {% if messages %}
            {% for message in messages %}
                <div class="{% if message.tags == 'success' %}message-success{% elif message.tags == 'error' %}message-error{% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        <a href="{% url 'manage_services' %}" class="button">Back to Main</a>
        <h4>Hotel List</h4>

        <div style="overflow-x:auto; margin-bottom:2rem;">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Hotel Name</th>
                        <th>Contact</th>
                        <th>Location</th>
                        <th>Rent/night</th>
                        <th>Rooms</th>
                        <th>Availability Date</th>
                        <th>Facilities</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for hotel in hotels %}
                    <tr class="{% if forloop.counter|divisibleby:2 %}row-even{% else %}row-odd{% endif %}">
                        <td>{{ hotel.pk }}</td>
                        <td>{{ hotel.hotel_name }}</td>
                        <td>{{ hotel.contact_number }}</td>
                        <td>{{ hotel.location }}</td>
                        <td>{{ hotel.room_rent }}</td>
                        <td>{{ hotel.available_rooms }} / {{ hotel.total_rooms }}</td>
                        <td>{{ hotel.booking_date|date:"Y-m-d" }}</td>
                        <td>{{ hotel.facilities }}</td>
                        <td>
                            <button onclick="showUpdateForm('{{ hotel.pk }}')" class="update">Update</button>
                            <form method="post" action="{% url 'hotel_management' %}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this hotel?');">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="delete">
                                <input type="hidden" name="hotel_id" value="{{ hotel.pk }}">
                                <button type="submit" class="delete">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div id="add-form-section">
            <h3>Add New Hotel</h3>
            <form method="post" action="{% url 'hotel_management' %}">
                {% csrf_token %}
                <input type="hidden" name="action" value="add">

                <label>Hotel Name:</label>
                <input type="text" name="hotel_name" required>

                <label>Contact Number:</label>
                <input type="text" name="contact_number" required>

                <label>Location:</label>
                <input type="text" name="location" required>

                <label>Room Rent (per night):</label>
                <input type="number" step="0.01" name="room_rent" required>

                <label>Available Rooms:</label>
                <input type="number" name="available_rooms" required>

                <label>Total Rooms:</label>
                <input type="number" name="total_rooms" required>

                <label>Facilities:</label>
                <textarea name="facilities"></textarea>

                <label>Availability Date:</label>
                <input type="date" id="add-booking-date" name="booking_date" required>

                <button type="submit" style="width:100%; background-color:darkgreen; color:white; padding:0.5rem; border-radius:0.375rem;">Add Hotel</button>
            </form>
        </div>

        {% for hotel in hotels %}
        <div id="update-form-{{ hotel.pk }}" class="hidden">
            <h3>Update Hotel (ID: {{ hotel.pk }})</h3>
            <form method="post" action="{% url 'hotel_management' %}">
                {% csrf_token %}
                <input type="hidden" name="action" value="update">
                <input type="hidden" name="hotel_id" value="{{ hotel.pk }}">

                <label>Hotel Name:</label>
                <input type="text" name="hotel_name" value="{{ hotel.hotel_name }}" required>

                <label>Contact Number:</label>
                <input type="text" name="contact_number" value="{{ hotel.contact_number }}" required>

                <label>Location:</label>
                <input type="text" name="location" value="{{ hotel.location }}" required>

                <label>Room Rent (per night):</label>
                <input type="number" step="0.01" name="room_rent" value="{{ hotel.room_rent }}" required>

                <label>Available Rooms:</label>
                <input type="number" name="available_rooms" value="{{ hotel.available_rooms }}" required>

                <label>Total Rooms:</label>
                <input type="number" name="total_rooms" value="{{ hotel.total_rooms }}" required>

                <label>Facilities:</label>
                <textarea name="facilities">{{ hotel.facilities }}</textarea>

                <label>Availability Date:</label>
                <input type="date" id="update-booking-date-{{ hotel.pk }}" name="booking_date" value="{{ hotel.booking_date|date:'Y-m-d' }}" required>

                <div class="flex-space">
                    <button type="submit" style="flex:1; background-color:darkgreen; color: white;">Update Hotel</button>
                    <button type="button" onclick="hideUpdateForm('{{ hotel.pk }}')" style="flex:1; background-color:gray; color: white;">Cancel</button>
                </div>
            </form>
        </div>
        {% endfor %}
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0');
        const dd = String(today.getDate()).padStart(2, '0');
        const minDate = `${yyyy}-${mm}-${dd}`;

        const maxDateObj = new Date();
        maxDateObj.setMonth(maxDateObj.getMonth() + 2);
        const maxYYYY = maxDateObj.getFullYear();
        const maxMM = String(maxDateObj.getMonth() + 1).padStart(2, '0');
        const maxDD = String(maxDateObj.getDate()).padStart(2, '0');
        const maxDate = `${maxYYYY}-${maxMM}-${maxDD}`;

        const addDateInput = document.getElementById('add-booking-date');
        if (addDateInput) {
            addDateInput.setAttribute('min', minDate);
            addDateInput.setAttribute('max', maxDate);
        }

        document.querySelectorAll('[id^="update-booking-date-"]').forEach(input => {
            input.setAttribute('min', minDate);
            input.setAttribute('max', maxDate);
        });
    });
</script>

</body>
</html>
